<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown Banner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        .banner-container {
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
			border: 2px solid #6b4ca3;
        }
        
        #canvas-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
        }
        
        #p5-canvas {
            display: block;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #canvas-wrapper {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="banner-container">
        <div id="canvas-wrapper"></div>
    </div>

    <script>
        let linhasDeFundo = [];
        let dataAlvo = new Date('2025-11-01T00:00:00');
        
        const CORES = {
            verde: "#46b2a3",
            roxo: "#6b4ca3",
            linhas: ["#ffc600", "#ff8ace", "#4cc1ec"],
            texto: "#2c3e50"
        };

        const CONFIG_DESKTOP = {
            linhasHorizontais: 20,
            linhasVerticais: 20,
            maxDistDeslocamento: 200,
            forcaDeslocamentoFundo: 6,
            forcaDeslocamentoPrincipal: 15,
            espessuraLinhaFundo: 4,
            espessuraLinhaPrincipal: 5,
            margemCentro: { width: 400, height: 160 }
        };

        const CONFIG_MOBILE = {
            linhasHorizontais: 30,
            linhasVerticais: 30,
            maxDistDeslocamento: 120,
            forcaDeslocamentoFundo: 3,
            forcaDeslocamentoPrincipal: 10,
            espessuraLinhaFundo: 3,
            espessuraLinhaPrincipal: 4,
            margemCentro: { width: 280, height: 160 }
        };

        let isMobile = false;
        let CONFIG = CONFIG_DESKTOP;
        let touchX = 0, touchY = 0;
        let mouseXAnt = 0, mouseYAnt = 0;
        let tempoUltimaAtualizacao = 0;
        const INTERVALO_ATUALIZACAO = 16;

        function setup() {
            let container = document.getElementById("canvas-wrapper");
            if (!container) {
                console.error("Canvas container not found!");
                return;
            }

            detectarDispositivo();
            
            let alturaCanvas = isMobile ? 200 : 300;
            
            let canvas = createCanvas(container.offsetWidth, alturaCanvas);
            canvas.elt.id = "p5-canvas";
            canvas.parent("canvas-wrapper");
			
			canvas.elt.addEventListener('click', function() {
                window.open('https://app.ciente.studio/xiconginternacionalsobreculturas', '_blank');
            });
			
			canvas.elt.style.cursor = 'pointer';

            textAlign(CENTER, CENTER);
            rectMode(CENTER);
            
            if (isMobile) {
                canvas.elt.addEventListener('touchstart', handleTouch, { passive: false });
                canvas.elt.addEventListener('touchmove', handleTouch, { passive: false });
                canvas.elt.addEventListener('touchend', handleTouchEnd, { passive: false });
            }
            
            gerarLinhasDeFundo();
        }

        function detectarDispositivo() {
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                       window.innerWidth <= 768;
            CONFIG = isMobile ? CONFIG_MOBILE : CONFIG_DESKTOP;
        }

        function handleTouch(e) {
            e.preventDefault();
            if (e.touches.length > 0) {
                let rect = e.target.getBoundingClientRect();
                touchX = e.touches[0].clientX - rect.left;
                touchY = e.touches[0].clientY - rect.top;
                mouseX = touchX;
                mouseY = touchY;
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
        }

        function draw() {
            let agora = millis();
            if (agora - tempoUltimaAtualizacao < INTERVALO_ATUALIZACAO) return;
            tempoUltimaAtualizacao = agora;

            background(255);
            desenharFundo();
            desenharCountdown();
            
            mouseXAnt = mouseX;
            mouseYAnt = mouseY;
			
			// Animação de linhas saindo do cursor
            if (
    mouseX >= 0 && mouseX <= width &&
    mouseY >= 0 && mouseY <= height
) {
    desenharLinhasCursor(mouseX, mouseY);
}
        }

        function estaNoEspacoCentral(x, y) {
            let centroX = width / 2;
            let centroY = height / 2;
            let margemX = CONFIG.margemCentro.width / 2;
            let margemY = CONFIG.margemCentro.height / 2;
            
            return x >= centroX - margemX && x <= centroX + margemX && 
                   y >= centroY - margemY && y <= centroY + margemY;
        }

        function gerarLinhasDeFundo() {
            linhasDeFundo = [];
            
            function criarLinha(startX, startY, direcoes, condicaoParada) {
                let linha = {
                    segmentos: [],
                    cor: color(CORES.linhas[linhasDeFundo.length % CORES.linhas.length]),
                    espessura: CONFIG.espessuraLinhaFundo
                };

                let x = startX, y = startY;
                let direcaoAtual = random(direcoes);

                while (condicaoParada(x, y)) {
                    let len = isMobile ? random(50, 100) : random(80, 160);
                    let inicioX = x, inicioY = y;
                    let novoX = x, novoY = y;

                    switch(direcaoAtual) {
                        case "horizontal": novoX += len; break;
                        case "vertical": novoY += len; break;
                        case "diagonal-up":
                            novoX += len * 0.7; novoY -= len * 0.7;
                            novoY = constrain(novoY, -50, height + 50);
                            break;
                        case "diagonal-down":
                            novoX += len * 0.7; novoY += len * 0.7;
                            novoY = constrain(novoY, -50, height + 50);
                            break;
                    }

                    // Verificar se o segmento passa pelo espaço central
                    let passaPeloCentro = false;
                    for (let t = 0; t <= 1; t += 0.1) {
                        let checkX = lerp(inicioX, novoX, t);
                        let checkY = lerp(inicioY, novoY, t);
                        if (estaNoEspacoCentral(checkX, checkY)) {
                            passaPeloCentro = true;
                            break;
                        }
                    }

                    if (!passaPeloCentro) {
                        linha.segmentos.push({ x1: inicioX, y1: inicioY, x2: novoX, y2: novoY });
                        x = novoX;
                        y = novoY;
                    } else {
                        // Se passa pelo centro, muda direção ou para
                        if (random() < 0.7) {
                            direcaoAtual = random(direcoes);
                            continue;
                        } else {
                            break;
                        }
                    }

                    if (random() < 0.3) direcaoAtual = random(direcoes);
                }
                return linha;
            }

            // Linhas horizontais
            for (let i = 0; i < CONFIG.linhasHorizontais; i++) {
                linhasDeFundo.push(criarLinha(
                    random(-200, -50), random(height * 0.1, height * 0.9),
                    ["horizontal", "diagonal-up", "diagonal-down"],
                    (x, y) => x < width + 200
                ));
            }
            
            // Linhas verticais
            for (let i = 0; i < CONFIG.linhasVerticais; i++) {
                linhasDeFundo.push(criarLinha(
                    random(width * 0.1, width * 0.9), random(-200, -50),
                    ["vertical", "diagonal-up", "diagonal-down"],
                    (x, y) => y < height + 200
                ));
            }
        }

        function desenharFundo() {
            strokeCap(ROUND);
            strokeJoin(ROUND);
            noFill();

            for (let linha of linhasDeFundo) {
                if (linha.segmentos.length === 0) continue;
                
                stroke(linha.cor);
                strokeWeight(linha.espessura);
                beginShape();
                
                let inicio = deslocarFundo(linha.segmentos[0].x1, linha.segmentos[0].y1);
                vertex(inicio.x, inicio.y);

                for (let i = 0; i < linha.segmentos.length; i++) {
                    let seg = linha.segmentos[i];
                    let fim = deslocarFundo(seg.x2, seg.y2);

                    if (i === linha.segmentos.length - 1) {
                        vertex(fim.x, fim.y);
                    } else {
                        let prox = linha.segmentos[i + 1];
                        let raio = linha.espessura * 1.5;

                        let dx1 = seg.x2 - seg.x1, dy1 = seg.y2 - seg.y1;
                        let len1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
                        let dx2 = prox.x2 - prox.x1, dy2 = prox.y2 - prox.y1;
                        let len2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);

                        if (len1 > 0 && len2 > 0) {
                            dx1 /= len1; dy1 /= len1; dx2 /= len2; dy2 /= len2;
                            let distIni = Math.min(raio, len1 * 0.3);
                            let distFim = Math.min(raio, len2 * 0.3);

                            let curvaIni = deslocarFundo(seg.x2 - dx1 * distIni, seg.y2 - dy1 * distIni);
                            let controle = deslocarFundo(seg.x2, seg.y2);
                            let curvaFim = deslocarFundo(seg.x2 + dx2 * distFim, seg.y2 + dy2 * distFim);

                            vertex(curvaIni.x, curvaIni.y);
                            quadraticVertex(controle.x, controle.y, curvaFim.x, curvaFim.y);
                        }
                    }
                }
                endShape();
            }
        }

        function desenharCountdown() {
            let agora = new Date();
            let diferenca = dataAlvo - agora;
            
            push();
            fill(CORES.texto);
            noStroke();
            
            let centroX = width / 2;
            let centroY = height / 2;
            
            if (diferenca > 0) {
                // Calcular tempo restante
                let dias = Math.floor(diferenca / (1000 * 60 * 60 * 24));
                let horas = Math.floor((diferenca % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                let minutos = Math.floor((diferenca % (1000 * 60 * 60)) / (1000 * 60));
                let segundos = Math.floor((diferenca % (1000 * 60)) / 1000);
                
                // Título
                textSize(isMobile ? 28 : 42);
                textStyle(BOLD);
                fill ('#6b4ca3')
                text("Inscrições abertas!", centroX, centroY - (isMobile ? 40 : 50));
				textSize(isMobile ? 18 : 24);
                text("As inscrições se encerram em:", centroX, centroY );
                
                // Countdown
                textSize(isMobile ? 22 : 32);
                textStyle(BOLD);
                let countdownText = `${dias}d ${horas.toString().padStart(2, '0')}h ${minutos.toString().padStart(2, '0')}m ${segundos.toString().padStart(2, '0')}s`;
                text(countdownText, centroX, centroY + (isMobile ? 30 : 40));

                textSize(isMobile ? 10 : 14);
                text("Clique aqui para se inscrever", centroX, centroY + (isMobile ? 60 : 70));
                
            } else {
                // Inscrições abertas
                textSize(isMobile ? 28 : 42);
                textStyle(BOLD);
                fill(CORES.verde);
                text("INSCRIÇÕES ENCERRADAS!", centroX, centroY);
                
          }
            
            pop();
        }

        function deslocarFundo(x, y) {
            let dx = x - mouseX, dy = y - mouseY;
            let distSq = dx * dx + dy * dy;
            let maxDistSq = CONFIG.maxDistDeslocamento * CONFIG.maxDistDeslocamento;

            if (distSq < maxDistSq) {
                let d = Math.sqrt(distSq);
                let forca = map(d, 0, CONFIG.maxDistDeslocamento, CONFIG.forcaDeslocamentoFundo, 0);
                return { x: x + (dx / d) * forca, y: y + (dy / d) * forca };
            }
            return { x, y };
        }

        function windowResized() {
            let container = document.getElementById("canvas-wrapper");
            if (container) {
                detectarDispositivo();
                let alturaCanvas = isMobile ? 300 : 400;
                resizeCanvas(container.offsetWidth, alturaCanvas);
                gerarLinhasDeFundo();
            }
        }
		

 function desenharLinhasCursor(x, y) {
    push();
    stroke('#6b4ca3');
    strokeWeight(1.5);
    let t = millis() / 600.0;
    let nLinhas = 5;
    let angBase = -PI/2; // cima
    let angSpread = PI;  // leque bem aberto (PI/3 é fechado, PI é bem aberto)
    let raioInicio = 2;  // bem perto do cursor
    let raioFim = 8;    // comprimento da linha
    let raioAnim = 4 * sin(t * 2 * PI);
    for (let i = 0; i < nLinhas; i++) {
        let ang = angBase + angSpread * (i/(nLinhas-1) - 0.5);
        let x1 = x + cos(ang) * raioInicio;
        let y1 = y + sin(ang) * raioInicio;
        let r2 = raioFim + raioAnim;
        let x2 = x + cos(ang) * r2;
        let y2 = y + sin(ang) * r2;
        line(x1, y1, x2, y2);
    }
    pop();
}
    </script>
</body>